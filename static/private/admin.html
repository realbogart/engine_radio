<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script type="text/javascript" src="jquery.simple.websocket.js"></script>
		
		<script type="text/javascript">
		
		function validJSON(text) {
		    try {
		        JSON.parse(text);
		    } catch (e) {
		        return false;
		    }
		    return true;
		}

    function test()
    {
      alert("LOL")
    }

		function setSchedule(schedule)
		{
			jQuery('#schedule').html(JSON.stringify(schedule, null, 4));
		}

		var webSocket = $.simpleWebSocket({ url: '<websocket_server>' });
		webSocket.connect();
		webSocket.listen(function(msgString) {
			var msgJson = JSON.parse( msgString );

			if(msgJson.command == 'setSchedule') {
				setSchedule(msgJson.message.activeSchedule);
			}
		});
		
		$(function() {
			$('#update').click(function() {
				var scheduleText = $('#schedule').val();
				if(validJSON(scheduleText))
				{
          $.ajax({
              url: '/setSchedule',
              method: 'POST',
              contentType: 'application/json',
              dataType: 'json',
              data: scheduleText,
              success: function() {
                  $('#info').html("Updated schedule!");
              },
              error: function(jqXHR, textStatus, errorThrown) {
                  $('#info').html("Failed to update schedule: " + textStatus);
                  console.error("Error:", errorThrown);
                  console.error("Response Text:", jqXHR.responseText);
              }
          });
				}
				else
				{
					$('#info').html("Invalid JSON");
				}
			});
		});
		</script>
	</head>
	<body>
		<textarea id="schedule" rows="48" cols="200"></textarea><br><br>
		<input id="update" type="submit" value="Update"/>

		<div id="sheetSchedule"></div>
		<div id="info"></div>
	</body>
</html>
